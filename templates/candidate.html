<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Candidate View ¬∑ SmartHire AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Mono:wght@300;400;500;600&family=IBM+Plex+Sans:wght@300;400;500&display=swap"
    rel="stylesheet" />
  <style>
    :root {
      --teal: #2DD4BF;
      --teal-lo: rgba(45, 212, 191, 0.1);
      --ink: #050505;
      --s1: rgba(10, 10, 10, 0.75);
      --s2: rgba(18, 18, 18, 0.6);
      --s3: rgba(24, 24, 24, 0.8);
      --border: #222222;
      --border2: #333333;
      --text: #E0DBD1;
      --muted: #666666;
      --muted2: #888888;
      --green: #4ADE80;
      --yellow: #FACC15;
      --red: #F87171;
      --amber: #F5A623;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: var(--ink);
      color: var(--text);
      font-family: 'IBM Plex Mono', monospace;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Ambient Backgrounds */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 0, 0, 0.15) 2px, rgba(0, 0, 0, 0.15) 4px);
      pointer-events: none;
      z-index: 100;
    }

    .bg-glow {
      position: fixed;
      inset: 0;
      z-index: -1;
      background: radial-gradient(circle at 30% 70%, rgba(45, 212, 191, 0.06) 0%, transparent 60%);
      animation: breathe 8s ease-in-out infinite alternate;
    }

    .bg-grid {
      position: fixed;
      inset: 0;
      z-index: -2;
      background-image: linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
      background-size: 48px 48px;
    }

    /* ---- Layout ---- */
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      width: 240px;
      background: var(--s1);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      z-index: 50;
    }

    .main-area {
      margin-left: 240px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .topbar {
      height: 60px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 32px;
      background: var(--s1);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      position: sticky;
      top: 0;
      z-index: 40;
    }

    .content {
      padding: 40px 32px;
      max-width: 1000px;
      margin: 0 auto;
      width: 100%;
    }

    /* ---- Sidebar Elements ---- */
    .logo-block {
      padding: 28px 24px 24px;
      border-bottom: 1px solid var(--border);
    }

    .logo-text {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 32px;
      letter-spacing: 0.06em;
      line-height: 1;
      text-shadow: 0 0 20px rgba(45, 212, 191, 0.2);
    }

    .logo-sub {
      font-size: 10px;
      letter-spacing: 0.25em;
      color: var(--muted2);
      text-transform: uppercase;
      margin-top: 6px;
    }

    .nav-section {
      padding: 24px 20px 10px;
      font-size: 10px;
      letter-spacing: 0.25em;
      color: var(--muted);
      text-transform: uppercase;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 20px;
      font-size: 11px;
      letter-spacing: 0.1em;
      color: var(--muted2);
      cursor: pointer;
      border-left: 2px solid transparent;
      transition: all 0.2s ease;
      text-transform: uppercase;
      text-decoration: none;
    }

    .nav-item:hover {
      color: var(--text);
      background: rgba(255, 255, 255, 0.03);
    }

    .nav-item.active {
      color: var(--teal);
      border-left-color: var(--teal);
      background: var(--teal-lo);
      text-shadow: 0 0 10px rgba(45, 212, 191, 0.3);
    }

    .sidebar-footer {
      margin-top: auto;
      padding: 20px;
      border-top: 1px solid var(--border);
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--teal);
      animation: pulse 2s infinite;
      display: inline-block;
      box-shadow: 0 0 8px var(--teal);
    }

    /* ---- UI elements ---- */
    .section-label {
      font-size: 10px;
      letter-spacing: 0.25em;
      color: var(--muted2);
      text-transform: uppercase;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .section-label::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    .glass-card {
      background: var(--s2);
      border: 1px solid var(--border);
      border-radius: 6px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .upload-zone {
      border: 1px dashed var(--border2);
      background: var(--s2);
      border-radius: 6px;
      padding: 48px 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      position: relative;
      overflow: hidden;
    }

    .upload-zone:hover,
    .upload-zone.drag-over {
      border-color: var(--teal);
      background: rgba(45, 212, 191, 0.05);
      box-shadow: 0 0 30px rgba(45, 212, 191, 0.05) inset;
      transform: translateY(-2px);
    }

    .upload-zone input[type=file] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
      width: 100%;
      height: 100%;
      z-index: 2;
    }

    .upload-icon {
      font-size: 32px;
      margin-bottom: 16px;
      display: inline-block;
      transition: transform 0.3s ease;
    }

    .upload-zone:hover .upload-icon {
      transform: translateY(-4px);
      color: var(--teal);
    }

    .input-field {
      background: var(--s3);
      border: 1px solid var(--border2);
      border-radius: 4px;
      color: var(--text);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 13px;
      padding: 12px 16px;
      width: 100%;
      outline: none;
      transition: all 0.2s ease;
    }

    .input-field:focus {
      border-color: var(--teal);
      box-shadow: 0 0 0 3px rgba(45, 212, 191, 0.15);
    }

    .input-field::placeholder {
      color: var(--muted);
    }

    .btn-primary {
      background: var(--teal);
      color: #000;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      padding: 14px 32px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
    }

    .btn-primary:hover:not(:disabled) {
      background: #5EEAD4;
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(45, 212, 191, 0.3);
    }

    .btn-primary:disabled {
      opacity: 0.3;
      cursor: not-allowed;
      filter: grayscale(1);
    }

    .btn-ghost {
      background: transparent;
      color: var(--muted2);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      border-radius: 4px;
      padding: 8px 16px;
      border: 1px solid var(--border2);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-ghost:hover {
      border-color: var(--teal);
      color: var(--teal);
      background: rgba(45, 212, 191, 0.05);
    }

    .btn-ai {
      background: rgba(245, 166, 35, 0.05);
      color: var(--amber);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      padding: 14px 32px;
      border: 1px solid var(--amber);
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .btn-ai:hover {
      background: var(--amber);
      color: #000;
      box-shadow: 0 8px 25px rgba(245, 166, 35, 0.4);
      transform: translateY(-2px);
    }

    /* ---- Score display ---- */
    .score-ring-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px 0;
    }

    .score-ring {
      position: relative;
      width: 180px;
      height: 180px;
      filter: drop-shadow(0 0 15px rgba(45, 212, 191, 0.2));
    }

    .score-ring svg {
      transform: rotate(-90deg);
      width: 100%;
      height: 100%;
    }

    .score-number {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .score-val {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 64px;
      line-height: 1;
      text-shadow: 0 0 20px rgba(45, 212, 191, 0.4);
    }

    .score-unit {
      font-size: 12px;
      letter-spacing: 0.2em;
      color: var(--muted2);
      text-transform: uppercase;
      margin-top: -4px;
    }

    .conf-badge {
      display: inline-block;
      font-size: 9px;
      letter-spacing: 0.15em;
      padding: 3px 8px;
      border-radius: 3px;
      text-transform: uppercase;
      font-weight: 500;
    }

    .conf-strong {
      background: rgba(74, 222, 128, 0.1);
      border: 1px solid rgba(74, 222, 128, 0.2);
      color: var(--green);
    }

    .conf-medium {
      background: rgba(250, 204, 21, 0.1);
      border: 1px solid rgba(250, 204, 21, 0.2);
      color: var(--yellow);
    }

    .conf-weak {
      background: rgba(248, 113, 113, 0.1);
      border: 1px solid rgba(248, 113, 113, 0.2);
      color: var(--red);
    }

    .skill-tag {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--s3);
      border: 1px solid var(--border2);
      border-radius: 4px;
      font-size: 11px;
      padding: 6px 12px;
      color: var(--text);
    }

    .stat-row {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-box {
      flex: 1;
      padding: 20px;
      transition: transform 0.2s ease;
    }

    .stat-box:hover {
      transform: translateY(-2px);
      background: rgba(255, 255, 255, 0.02);
    }

    .stat-val {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 36px;
      line-height: 1;
    }

    .stat-lbl {
      font-size: 10px;
      letter-spacing: 0.2em;
      color: var(--muted);
      text-transform: uppercase;
      margin-top: 6px;
    }

    /* loader & animations */
    .loader-bar {
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--teal), transparent);
      background-size: 200% 100%;
      animation: shimmer 1.4s infinite;
    }

    @keyframes shimmer {
      0% {
        background-position: -200% 0
      }

      100% {
        background-position: 200% 0
      }
    }

    @keyframes breathe {
      0% {
        opacity: 0.5;
        transform: scale(1);
      }

      100% {
        opacity: 1;
        transform: scale(1.05);
      }
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
        transform: scale(1);
      }

      50% {
        opacity: 0.4;
        transform: scale(0.8);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(15px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-in {
      animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      opacity: 0;
    }

    /* toast */
    .toast {
      position: fixed;
      bottom: 32px;
      right: 32px;
      background: var(--s2);
      border: 1px solid var(--border2);
      border-radius: 6px;
      padding: 16px 24px;
      font-size: 12px;
      z-index: 500;
      display: none;
      align-items: center;
      gap: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    }

    .toast.show {
      display: flex;
      animation: fadeIn 0.3s ease forwards;
    }

    .toast.error {
      border-left: 3px solid var(--red);
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: var(--ink);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border2);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--muted);
    }
  </style>
</head>

<body>

  <div class="bg-grid"></div>
  <div class="bg-glow"></div>

  <aside class="sidebar">
    <div class="logo-block">
      <div class="logo-text">SMART<span style="color:var(--teal);">HIRE</span></div>
      <div class="logo-sub">Candidate Portal</div>
    </div>
    <div style="flex:1;padding-top:16px;">
      <div class="nav-section">My Profile</div>
      <div class="nav-item active">
        <span style="font-size:14px;">‚óà</span> Score Lookup
      </div>

      <div class="nav-section" style="margin-top:24px;">System</div>
      <a href="/" class="nav-item">
        <span style="font-size:14px;">‚Üê</span> Return Home
      </a>
    </div>
    <div class="sidebar-footer">
      <div style="font-size:10px;letter-spacing:0.15em;color:var(--muted);text-transform:uppercase;line-height:1.8;">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px; color:var(--text);">
          <span class="status-dot"></span> Core Online
        </div>
        Upload 1 PDF<br>Get instant score
      </div>
    </div>
  </aside>

  <div class="main-area">
    <div class="topbar">
      <span style="font-size:12px;letter-spacing:0.15em;color:var(--text);text-transform:uppercase; font-weight:500;"
        id="topbar-title">Candidate <span style="color:var(--muted)">/</span> Score Lookup</span>
      <span
        style="font-size:11px;letter-spacing:0.15em;color:var(--teal);text-transform:uppercase; background:var(--teal-lo); padding:4px 12px; border-radius:20px;"
        id="topbar-status">Awaiting Input</span>
    </div>

    <div id="loader" style="display:none;">
      <div class="loader-bar"></div>
    </div>

    <div class="content">

      <div id="view-upload" class="animate-in">
        <div style="margin-bottom:48px;">
          <p style="font-size:11px;letter-spacing:0.3em;color:var(--teal);text-transform:uppercase;margin-bottom:12px;">
            Step 01 // Configuration</p>
          <h2
            style="font-family:'Bebas Neue',sans-serif;font-size:56px;letter-spacing:0.04em;line-height:0.9; color:#FFF; text-shadow: 0 0 30px rgba(255,255,255,0.1);">
            SKILL SCORE<br>LOOKUP</h2>
          <p style="font-size:14px;color:var(--muted2);margin-top:16px;line-height:1.6; max-width:600px;">Upload your
            resume PDF and select a target role to get your personalised skill strength score and category breakdown.
          </p>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:40px;">
          <div>
            <div class="section-label">Your Resume Document</div>
            <div class="upload-zone" id="dropzone">
              <input type="file" id="fileInput" accept=".pdf" onchange="handleFile(this.files[0])" />
              <span class="upload-icon">üìÑ</span>
              <p style="font-size:14px;color:var(--text);margin-bottom:8px; font-weight:500;">Drop your PDF here or
                click</p>
              <p style="font-size:11px;color:var(--muted);letter-spacing:0.05em;">Single file ¬∑ PDF only</p>
            </div>
            <div id="file-chip"
              style="display:none;margin-top:16px;background:var(--s3);border:1px solid var(--border2);border-radius:4px;padding:12px 16px;align-items:center;gap:12px;">
              <span style="color:var(--teal);font-size:12px;">üìÑ</span>
              <span id="file-name"
                style="flex:1;font-size:12px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap; color:var(--text);"></span>
              <span id="file-size" style="font-size:11px;color:var(--muted);"></span>
              <span onclick="clearFile()"
                style="cursor:pointer;color:var(--muted);font-size:16px;transition:color 0.2s;"
                onmouseover="this.style.color='var(--red)'" onmouseout="this.style.color='var(--muted)'">‚úï</span>
            </div>
          </div>

          <div style="display:flex;flex-direction:column;gap:24px;">
            <div>
              <div class="section-label">Candidate Name</div>
              <input class="input-field" type="text" id="nameInput" placeholder="e.g. Atharva Kulkarni" />
            </div>
            <div>
              <div class="section-label">Target Role / Domain</div>
              <input class="input-field" type="text" id="domainInput" placeholder="e.g. Machine Learning Engineer"
                value="Software Engineering" />
            </div>
            <div>
              <div class="section-label">Quick Select</div>
              <div style="display:flex;flex-wrap:wrap;gap:10px;">
                <button class="btn-ghost" onclick="setDomain('Software Engineering')">SWE</button>
                <button class="btn-ghost" onclick="setDomain('Machine Learning Engineer')">ML / AI</button>
                <button class="btn-ghost" onclick="setDomain('Data Engineer')">Data</button>
                <button class="btn-ghost" onclick="setDomain('DevOps / Cloud Engineer')">DevOps</button>
              </div>
            </div>

            <div style="margin-top:auto;padding-top:24px;border-top:1px solid var(--border);">
              <button class="btn-primary" id="analyzeBtn" onclick="runAnalysis()" disabled>
                <span>‚óà</span> ANALYSE MY RESUME
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="view-results" style="display:none;" class="animate-in">

        <div
          style="margin-bottom:40px;display:flex;align-items:baseline;justify-content:space-between;flex-wrap:wrap;gap:16px;">
          <div>
            <p
              style="font-size:11px;letter-spacing:0.3em;color:var(--teal);text-transform:uppercase;margin-bottom:10px;">
              Step 02 // Your Results</p>
            <h2
              style="font-family:'Bebas Neue',sans-serif;font-size:56px;letter-spacing:0.04em;line-height:1; color:#FFF; text-shadow: 0 0 30px rgba(255,255,255,0.1);"
              id="result-name-heading">SCORE REPORT</h2>
          </div>
          <button class="btn-ghost" onclick="showUpload()">‚Üê Re-upload Document</button>
        </div>

        <div style="display:flex;gap:32px;align-items:stretch;margin-bottom:32px; flex-wrap:wrap;">

          <div class="glass-card"
            style="padding:32px; display:flex;flex-direction:column;align-items:center;justify-content:center; flex: 1; min-width:300px;">
            <div class="score-ring-wrap">
              <div class="score-ring">
                <svg viewBox="0 0 160 160">
                  <circle cx="80" cy="80" r="66" fill="none" stroke="#1E1E1E" stroke-width="10" />
                  <circle cx="80" cy="80" r="66" fill="none" stroke="var(--teal)" stroke-width="10"
                    stroke-linecap="round" stroke-dasharray="414.69" id="score-arc" stroke-dashoffset="414.69"
                    style="transition:stroke-dashoffset 1.5s cubic-bezier(0.16,1,0.3,1);" />
                </svg>
                <div class="score-number">
                  <span class="score-val" id="score-display" style="color:var(--teal);">0</span>
                  <span class="score-unit">/ 100</span>
                </div>
              </div>
            </div>
            <p style="font-size:11px;letter-spacing:0.25em;color:var(--text);text-transform:uppercase;text-align:center; font-weight:600;"
              id="score-verdict">‚Äî</p>
            <p style="font-size:11px;color:var(--muted);margin-top:8px;text-align:center; letter-spacing:0.05em;"
              id="score-domain-tag">‚Äî</p>
          </div>

          <div style="flex:2; display:flex;flex-direction:column;gap:16px; min-width:400px;">
            <div class="stat-row">
              <div class="glass-card stat-box">
                <div class="stat-val" id="stat-total" style="color:var(--text);">0</div>
                <div class="stat-lbl">Total Skills</div>
              </div>
              <div class="glass-card stat-box">
                <div class="stat-val" style="color:var(--green); text-shadow: 0 0 15px rgba(74,222,128,0.3);"
                  id="stat-strong">0</div>
                <div class="stat-lbl">Strong Match</div>
              </div>
              <div class="glass-card stat-box">
                <div class="stat-val" style="color:var(--yellow); text-shadow: 0 0 15px rgba(250,204,21,0.3);"
                  id="stat-medium">0</div>
                <div class="stat-lbl">Medium Match</div>
              </div>
              <div class="glass-card stat-box">
                <div class="stat-val" style="color:var(--red); text-shadow: 0 0 15px rgba(248,113,113,0.3);"
                  id="stat-weak">0</div>
                <div class="stat-lbl">Weak Match</div>
              </div>
            </div>

            <div class="glass-card" style="padding:24px;">
              <p
                style="font-size:10px;letter-spacing:0.2em;color:var(--muted2);text-transform:uppercase;margin-bottom:16px;">
                Confidence Distribution</p>
              <div style="display:flex;height:8px;overflow:hidden;border-radius:4px;gap:2px;" id="conf-bar"></div>
              <div style="display:flex;gap:20px;margin-top:12px;font-size:11px;color:var(--text); font-weight:500;">
                <span style="display:flex;align-items:center;gap:6px;"><span style="color:var(--green);">‚óè</span>
                  Strong</span>
                <span style="display:flex;align-items:center;gap:6px;"><span style="color:var(--yellow);">‚óè</span>
                  Medium</span>
                <span style="display:flex;align-items:center;gap:6px;"><span style="color:var(--red);">‚óè</span>
                  Weak</span>
              </div>
            </div>

            <div id="boost-box" style="display:none;" class="glass-card">
              <div style="border-left:3px solid var(--amber); padding:16px 20px; border-radius:4px;">
                <p
                  style="font-size:10px;letter-spacing:0.2em;color:var(--amber);text-transform:uppercase;margin-bottom:8px; font-weight:600;">
                  ‚¨Ü Advanced Project Boost Applied (+25%)</p>
                <p style="font-size:12px;color:var(--text); line-height:1.5;" id="boost-terms">‚Äî</p>
              </div>
            </div>
          </div>
        </div>

        <div class="glass-card" style="padding:32px;margin-bottom:32px;">
          <div class="section-label">Detected Skills Profile</div>
          <div id="skills-grid"
            style="display:grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap:24px; margin-top:24px;">
            ‚Äî</div>
        </div>

        <div class="glass-card"
          style="border-color: rgba(245,166,35,0.4); background: linear-gradient(135deg, rgba(245,166,35,0.05) 0%, rgba(18,18,18,0.8) 100%); padding:40px; text-align:center; box-shadow: 0 0 30px rgba(245,166,35,0.05) inset;">
          <p
            style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:0.04em; color:#FFF; margin-bottom:12px;">
            WANT A PERSONALISED ROADMAP?</p>
          <p
            style="font-size:14px;color:var(--text);margin-bottom:24px;line-height:1.6; max-width:600px; margin-left:auto; margin-right:auto;">
            Let Claude AI analyse your skill gaps and generate a visual roadmap with step-by-step learning suggestions
            to hit your target role.
          </p>
          <button class="btn-ai" onclick="goToSuggest()">
            <span style="font-size:16px;">‚ú¶</span> GENERATE AI ANALYSIS
          </button>
        </div>

      </div>
    </div>
  </div>

  <div class="toast" id="toast">
    <span id="toast-icon" style="color:var(--red); font-size:16px;">‚úï</span>
    <span id="toast-msg" style="color:var(--text);">‚Äî</span>
  </div>

  <script>
    let uploadedFile = null;
    let resultData = null;

    const dz = document.getElementById('dropzone');
    dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('drag-over'); });
    dz.addEventListener('dragleave', () => dz.classList.remove('drag-over'));
    dz.addEventListener('drop', e => { e.preventDefault(); dz.classList.remove('drag-over'); handleFile(e.dataTransfer.files[0]); });

    function handleFile(f) {
      if (!f || f.type !== 'application/pdf') { showToast('Not a valid PDF file.'); return; }
      uploadedFile = f;
      const chip = document.getElementById('file-chip');
      document.getElementById('file-name').textContent = f.name;
      document.getElementById('file-size').textContent = (f.size / 1024).toFixed(0) + ' KB';
      chip.style.display = 'flex';
      document.getElementById('analyzeBtn').disabled = false;
    }

    function clearFile() {
      uploadedFile = null;
      document.getElementById('file-chip').style.display = 'none';
      document.getElementById('fileInput').value = '';
      document.getElementById('analyzeBtn').disabled = true;
    }

    function setDomain(d) { document.getElementById('domainInput').value = d; }

    async function runAnalysis() {
      const name = document.getElementById('nameInput').value.trim() || 'Candidate';
      const domain = document.getElementById('domainInput').value.trim() || 'Software Engineering';

      setLoading(true, 'Analysing document structure‚Ä¶');

      const fd = new FormData();
      fd.append('resume', uploadedFile);
      fd.append('name', name);
      fd.append('domain', domain);

      try {
        const res = await fetch('/api/candidate/analyse', { method: 'POST', body: fd });
        const data = await res.json();
        if (!res.ok || data.error) throw new Error(data.error || 'Server error');

        resultData = data;
        renderResults(data);

        // Slight delay to allow DOM to render before animating arc
        document.getElementById('view-upload').style.display = 'none';
        document.getElementById('view-results').style.display = 'block';

      } catch (err) {
        showToast('Error: ' + err.message);
      } finally {
        setLoading(false);
      }
    }

    function renderResults(d) {
      const pct = Math.round(d.score * 100);
      const scoreColor = pct >= 70 ? 'var(--green)' : pct >= 45 ? 'var(--teal)' : 'var(--red)';

      document.getElementById('result-name-heading').textContent = (d.name || 'YOUR').toUpperCase() + "'S REPORT";

      const arc = 414.69;
      const offset = arc - (pct / 100) * arc;
      setTimeout(() => {
        const arcEl = document.getElementById('score-arc');
        arcEl.style.stroke = scoreColor;
        arcEl.style.filter = `drop-shadow(0 0 10px ${scoreColor})`;
        arcEl.setAttribute('stroke-dashoffset', offset);
      }, 150);

      animateNumber('score-display', 0, pct, 1200, scoreColor);

      const verdict = pct >= 75 ? 'Excellent Profile Match' : pct >= 55 ? 'Solid Foundation' : pct >= 35 ? 'Developing Skills' : 'Needs Strengthening';
      const verdictEl = document.getElementById('score-verdict');
      verdictEl.textContent = verdict;
      verdictEl.style.color = scoreColor;
      document.getElementById('score-domain-tag').textContent = "Domain Target: " + (d.domain || 'Unspecified');

      document.getElementById('stat-total').textContent = d.net_skills || 0;
      document.getElementById('stat-strong').textContent = d.metrics?.total_strong_skills || 0;
      document.getElementById('stat-medium').textContent = d.metrics?.total_medium_skills || 0;
      document.getElementById('stat-weak').textContent = d.metrics?.total_weak_skills || 0;

      const s = d.metrics?.total_strong_skills || 0;
      const m = d.metrics?.total_medium_skills || 0;
      const w = d.metrics?.total_weak_skills || 0;
      document.getElementById('conf-bar').innerHTML = `
      ${s > 0 ? `<div style="flex:${s};background:var(--green);box-shadow:0 0 10px rgba(74,222,128,0.5);"></div>` : ''}
      ${m > 0 ? `<div style="flex:${m};background:var(--yellow);box-shadow:0 0 10px rgba(250,204,21,0.5);"></div>` : ''}
      ${w > 0 ? `<div style="flex:${w};background:var(--red);box-shadow:0 0 10px rgba(248,113,113,0.5);"></div>` : ''}
    `;

      if (d.advanced_boost && d.advanced_boost > 0) {
        document.getElementById('boost-box').style.display = 'block';
        document.getElementById('boost-terms').innerHTML = '<strong>Keywords Detected:</strong> ' + (d.advanced_terms_found || []).join(', ');
      } else {
        document.getElementById('boost-box').style.display = 'none';
      }

      const skillsEl = document.getElementById('skills-grid');
      if (!d.skills || Object.keys(d.skills).length === 0) {
        skillsEl.innerHTML = '<p style="font-size:13px;color:var(--muted); grid-column: 1 / -1;">No skills detected. Please ensure your PDF contains readable text formatting.</p>';
        return;
      }

      skillsEl.innerHTML = Object.entries(d.skills).map(([cat, list], index) => `
      <div class="animate-in" style="animation-delay: ${index * 0.1}s">
        <p style="font-size:10px;letter-spacing:0.2em;color:var(--muted);text-transform:uppercase;margin-bottom:12px; border-bottom:1px solid var(--border2); padding-bottom:6px;">${cat.replace(/_/g, ' ')}</p>
        <div style="display:flex;flex-wrap:wrap;gap:8px;">
          ${list.map(s => `
            <span class="skill-tag">
              <span class="conf-badge ${s.confidence === 'strong' ? 'conf-strong' : s.confidence === 'medium' ? 'conf-medium' : 'conf-weak'}">${s.confidence.charAt(0)}</span>
              ${s.skill}
            </span>
          `).join('')}
        </div>
      </div>
    `).join('');
    }

    function animateNumber(id, from, to, dur, color) {
      const el = document.getElementById(id);
      if (color) el.style.color = color;
      const start = performance.now();
      function step(now) {
        const p = Math.min((now - start) / dur, 1);
        // Ease out cubic
        const ease = 1 - Math.pow(1 - p, 3);
        el.textContent = Math.round(from + (to - from) * ease);
        if (p < 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    function goToSuggest() {
      if (!resultData) return;
      sessionStorage.setItem('smarthire_result', JSON.stringify(resultData));
      window.location.href = '/suggest';
    }

    function showUpload() {
      document.getElementById('view-upload').style.display = 'block';
      document.getElementById('view-results').style.display = 'none';

      // Reset ring animation state
      const arcEl = document.getElementById('score-arc');
      if (arcEl) arcEl.setAttribute('stroke-dashoffset', '414.69');
    }

    function setLoading(on, msg = '') {
      document.getElementById('loader').style.display = on ? 'block' : 'none';
      const statusEl = document.getElementById('topbar-status');

      if (on) {
        statusEl.textContent = msg;
        statusEl.style.color = 'var(--amber)';
        statusEl.style.background = 'var(--amber-lo)';
      } else {
        statusEl.textContent = 'Awaiting Input';
        statusEl.style.color = 'var(--teal)';
        statusEl.style.background = 'var(--teal-lo)';
      }

      document.getElementById('analyzeBtn').disabled = on;
    }

    function showToast(msg) {
      const t = document.getElementById('toast');
      document.getElementById('toast-msg').textContent = msg;
      t.classList.remove('show');
      // Trigger reflow
      void t.offsetWidth;
      t.classList.add('show');
      t.classList.add('error');
      setTimeout(() => t.classList.remove('show'), 4000);
    }
  </script>
</body>

</html>
